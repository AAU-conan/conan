Bootstrap: docker
From: ubuntu:24.04
Stage: build

%setup
    mkdir $SINGULARITY_ROOTFS/cplex

%files
    src
    build.py
    build_configs.py
    fast-downward.py

%post
    apt-get update
    apt-get -y install --no-install-recommends cmake make g++-14 python3 g++-multilib git ca-certificates rustc cargo libboost-all-dev

    export cplex_DIR=/cplex
    ./build.py -j 4
    
# Stage 2: Run the planner
Bootstrap: docker
From: ubuntu:24.04
Stage: run

%setup
    mkdir $SINGULARITY_ROOTFS/cplex

# Copy planner binary and required files from Stage 1.
%files
    fast-downward.py
    driver
    
%files from build
    /builds/release/bin/downward
    /builds/release/bin/translate
        
%post
    apt-get update
    apt-get -y install --no-install-recommends python3 time gawk libgmp-dev
    apt-get clean
    rm -rf /var/lib/apt/lists/*

%runscript
    #! /bin/bash


    if [[ "$#" -lt 3 ]]; then
        die "usage: DOMAIN_FILE PROBLEM_FILE PLAN_FILE SEARCH_OPTIONS"
    fi

    $SINGULARITY_ROOTFS/fast-downward.py $@

   

%labels
Name        Dominance
Authors     Alvaro Torralba <alto@cs.aau.dk>
